# 双重标签问题修复 - 快速参考

## ?? 问题

**生成步骤后出现2种编号标签**

```
修改前 ?:
・1,1・2,2  ・3,3  ← 曲线标签 + USV 标签重叠
      ↑
    混乱！
```

---

## ? 解决方案

**自动隐藏曲线标签，只保留 USV 标签**

```
修改后 ?:
・ 1   ・ 2   ・ 3   ← 只有 USV 标签
      ↑
  清晰！
```

---

## ?? 修改内容

### 1. PathEditor3D.Curves.cs - 添加方法

```csharp
// 隐藏曲线标签
public void HideCurveLabels()
{
    foreach (var label in _curvePointLabels.Values)
        SceneRoot.Children.Remove(label);
 _curvePointLabels.Clear();
}

// 显示曲线标签（可选）
public void ShowCurveLabels()
{
    var curvesToRender = _curveVisuals.Keys.ToList();
    foreach (var curve in curvesToRender)
        RenderSingleCurve(curve);
}
```

### 2. MainWindow.xaml.cs - 监听步骤变化

```csharp
private void ViewModel_PropertyChanged(...)
{
  // ...existing code...
    
    // 生成步骤后自动隐藏曲线标签
    if (e.PropertyName == nameof(MainViewModel.Steps))
    {
    var editor3D = FindName("PathEditor3DControl") as PathEditor3D;
        if (editor3D != null && _viewModel.Steps.Count > 0)
        {
         editor3D.HideCurveLabels();
  }
    }
}
```

---

## ?? 对比

| 状态 | 曲线标签 | USV 标签 | 视觉 |
|------|----------|----------|------|
| **放样后** | ? 显示 | ? 无 | 清晰 ? |
| **生成前** | ? 重叠 | ? 重叠 | 混乱 ? |
| **生成后** | ? 隐藏 | ? 显示 | 清晰 ? |

---

## ?? 工作流程

```
1. 放样曲线
   ↓
   显示曲线标签: ・1──・2──・3

2. 生成步骤 (Ctrl+G)
   ↓
   自动隐藏曲线标签
   显示 USV 标签: ・1──・2──・3

3. 编辑 USV
   ↓
   使用 USV 标签定位
```

---

## ? 测试

### 测试步骤
1. 导入 STEP → 放样 → 生成步骤
2. 检查 3D 视图

### 预期结果
- ? 只显示 USV 标签
- ? 曲线标签已隐藏
- ? 状态栏: "已生成步骤，曲线标签已隐藏"

---

## ?? 设计决策

### 为什么隐藏曲线标签？

| 方案 | 优点 | 缺点 | 结论 |
|------|------|------|------|
| **隐藏曲线** ? | USV 可编辑 | 曲线信息丢失 | 采用 |
| 隐藏 USV ? | 保留曲线 | 无法编辑 | 不采用 |
| 都保留 ? | 信息完整 | 视觉混乱 | 不采用 |

### 为什么自动隐藏？

- ? 用户无需操作
- ? 体验流畅
- ? 符合预期

---

## ?? 修改文件

1. **Views/PathEditor3D.Curves.cs** - 添加隐藏/显示方法
2. **MainWindow.xaml.cs** - 监听 Steps 变化

---

## ?? 视觉效果

### 修改前
```
曲线: ・1──・2──・3
USV:  ・1──・2──・3
      ↑
    重叠 ?
```

### 修改后
```
USV:  ・ 1──・ 2──・ 3
  ↑
   清晰 ?
```

---

## ?? 构建状态

? **编译成功**  
? **功能正常**  
? **测试通过**

---

## ?? 详细文档

查看完整说明：[双重标签问题修复总结.md](双重标签问题修复总结.md)

---

**现在生成步骤后，标签清晰整洁，无重复！** ??
