# 3D场景中心坐标系实现说明

## ? 功能已实现

**需求**: 将坐标系从3D视图左下角移到场景中心（原点位置）

**实现**: 在场景原点绘制自定义的3D坐标系，会随着视图旋转而旋转

---

## ?? 实现方案

### 方案选择

**方案1**: 调整UI坐标系显示位置（不推荐）
- 只是改变UI元素的位置
- 坐标系不随场景旋转
- 不符合专业3D软件习惯

**方案2**: 在场景原点绘制3D坐标系 ? **已采用**
- 坐标系位于3D场景的原点 (0, 0, 0)
- 随着场景一起旋转
- 符合专业3D软件（如UG NX）的做法
- 更直观、更专业

---

## ?? 实现细节

### 1. 坐标系组件

**实现代码**:
```csharp
// Views/PathEditor3D.xaml.cs

// 坐标轴（使用ArrowVisual3D）
private ArrowVisual3D? _sceneAxisX,  _sceneAxisY, _sceneAxisZ;

// 坐标轴标签
private BillboardTextVisual3D? _sceneAxisLabelX, _sceneAxisLabelY, _sceneAxisLabelZ;
```

**组件说明**:
```
X 轴:
- 颜色: 红色
- 方向: 从 (0,0,0) 到 (10,0,0)
- 标签: "X" (红色)

Y 轴:
- 颜色: 绿色
- 方向: 从 (0,0,0) 到 (0,10,0)
- 标签: "Y" (绿色)

Z 轴:
- 颜色: 蓝色
- 方向: 从 (0,0,0) 到 (0,0,10)
- 标签: "Z" (蓝色)
```

---

### 2. 创建坐标系

**方法**: `CreateSceneCoordinateSystem()`

```csharp
private void CreateSceneCoordinateSystem()
{
    // 坐标系的长度（在视觉坐标下）
    double axisLength = 10.0 * _visualScale;  // 10 个逻辑单位
    double arrowDiameter = 0.3 * _visualScale;

    // 创建 X 轴（红色）
    _sceneAxisX = new ArrowVisual3D
    {
        Point1 = new Point3D(0, 0, 0),
        Point2 = new Point3D(axisLength, 0, 0),
        Diameter = arrowDiameter,
     Fill = new SolidColorBrush(Colors.Red)
    };
    SceneRoot.Children.Add(_sceneAxisX);

    // 创建 Y 轴（绿色）
    _sceneAxisY = new ArrowVisual3D
    {
        Point1 = new Point3D(0, 0, 0),
   Point2 = new Point3D(0, axisLength, 0),
     Diameter = arrowDiameter,
      Fill = new SolidColorBrush(Colors.Green)
    };
    SceneRoot.Children.Add(_sceneAxisY);

    // 创建 Z 轴（蓝色）
    _sceneAxisZ = new ArrowVisual3D
    {
        Point1 = new Point3D(0, 0, 0),
  Point2 = new Point3D(0, 0, axisLength),
        Diameter = arrowDiameter,
        Fill = new SolidColorBrush(Colors.Blue)
    };
    SceneRoot.Children.Add(_sceneAxisZ);

    // 创建标签
    double labelOffset = axisLength * 1.2;
   
    _sceneAxisLabelX = new BillboardTextVisual3D
    {
Text = "X",
    Position = new Point3D(labelOffset, 0, 0),
        Foreground = Brushes.Red,
FontSize = 16,
      FontWeight = FontWeights.Bold
    };
 SceneRoot.Children.Add(_sceneAxisLabelX);
   
    // ... Y 和 Z 轴标签类似
}
```

---

### 3. 关闭默认坐标系

**修改**: 在构造函数中

```csharp
public PathEditor3D()
{
    InitializeComponent();
   
    // ? 关闭默认坐标系，使用自定义坐标系
    HelixView.ShowCoordinateSystem = false;
    HelixView.ShowViewCube = true;  // 保留 ViewCube
   
    // ... 其他初始化代码
   
    // ? 创建场景坐标系
    CreateSceneCoordinateSystem();
}
```

---

## ?? 坐标系参数

### 尺寸设置

```csharp
参数:
- 轴长度: 10.0 * _visualScale = 1.0 单位
- 箭头直径: 0.3 * _visualScale = 0.03 单位
- 标签偏移: 轴长度 * 1.2 = 1.2 单位

视觉坐标转换:
- _visualScale = 0.1
- 逻辑单位 10 = 视觉单位 1.0
- 逻辑单位 100 = 视觉单位 10.0
```

### 颜色方案

```
标准颜色:
┌──────┬────────┬──────────┐
│ 轴   │ 颜色   │ RGB      │
├──────┼────────┼──────────┤
│ X 轴 │ 红色   │ #FF0000  │
│ Y 轴 │ 绿色   │ #00FF00  │
│ Z 轴 │ 蓝色   │ #0000FF  │
└──────┴────────┴──────────┘

符合国际标准（CAD/CAM软件通用）
```

---

## ?? 视觉效果

### 坐标系位置

**修改前** (默认坐标系):
```
3D 视图:
┌────────────────────────────┐
│     [ViewCube] ←─┤ 右上角
│               │
│       场景内容 │
│          │
│↓ [坐标系]           │ 左下角（UI元素）
└────────────────────────────┘
```

**修改后** (场景坐标系):
```
3D 视图:
┌────────────────────────────┐
│          [ViewCube] ←─┤ 右上角
│      │
│       u Z(蓝)    │
│      │        │
│  └─── Y(绿)    │
│     u        │
│ X(红)  ← 原点坐标系     │
│          │
└────────────────────────────┘

坐标系位于场景的原点 (0,0,0)
```

### 旋转效果

**关键特性**:
```
旋转视图时:
? 坐标系随着场景一起旋转
? 始终显示当前视图方向
? X/Y/Z 标签始终朝向相机（Billboard）
? 更符合专业3D软件习惯
```

---

## ?? 额外功能

### 1. 动态调整大小

**方法**: `UpdateCoordinateSystemSize(double scale)`

```csharp
// 用法示例
pathEditor3D.UpdateCoordinateSystemSize(2.0);  // 放大2倍
pathEditor3D.UpdateCoordinateSystemSize(0.5);  // 缩小0.5倍
```

**适用场景**:
```
- 场景很大时，可以放大坐标系
- 场景很小时，可以缩小坐标系
- 根据导入数据自动调整
```

### 2. 显示/隐藏坐标系

**方法**: `SetCoordinateSystemVisibility(bool visible)`

```csharp
// 用法示例
pathEditor3D.SetCoordinateSystemVisibility(false);  // 隐藏
pathEditor3D.SetCoordinateSystemVisibility(true);   // 显示
```

**适用场景**:
```
- 需要清爽的视图时隐藏
- 截图时可以选择性显示
- 提供用户选项控制
```

---

## ?? 使用示例

### 场景1: 查看坐标系

```
操作:
1. 启动应用
2. 观察3D视图中心
3. ? 看到红(X)/绿(Y)/蓝(Z)坐标轴

位置:
- 坐标系位于场景原点
- X 轴向右
- Y 轴向前
- Z 轴向上
```

### 场景2: 旋转视图

```
操作:
1. 使用中键旋转视图
2. 观察坐标系变化

效果:
? 坐标系随着旋转
? 标签始终朝向用户
? 清楚显示当前方向
```

### 场景3: 导入大型数据

```
问题:
- 导入的曲线很大（范围 0-1000）
- 默认坐标系（10单位）太小

解决:
// 在导入后调整坐标系大小
pathEditor3D.UpdateCoordinateSystemSize(10.0);
// 坐标系长度变为 100 单位
```

---

## ?? 自定义选项

### 修改坐标系长度

**位置**: `CreateSceneCoordinateSystem()` 方法

```csharp
// 原始代码
double axisLength = 10.0 * _visualScale;

// 修改为更长的坐标系（20个逻辑单位）
double axisLength = 20.0 * _visualScale;

// 修改为更短的坐标系（5个逻辑单位）
double axisLength = 5.0 * _visualScale;
```

### 修改箭头粗细

```csharp
// 原始代码
double arrowDiameter = 0.3 * _visualScale;

// 修改为更粗的箭头
double arrowDiameter = 0.5 * _visualScale;

// 修改为更细的箭头
double arrowDiameter = 0.2 * _visualScale;
```

### 修改标签大小

```csharp
// 原始代码
FontSize = 16

// 修改为更大的标签
FontSize = 20

// 修改为更小的标签
FontSize = 12
```

---

## ?? 完整对比

### 默认坐标系 vs 场景坐标系

| 特性 | 默认坐标系 | 场景坐标系 ? |
|------|------------|---------------|
| **位置** | 视图左下角 | 场景原点 |
| **旋转** | 不旋转 | 随场景旋转 |
| **可自定义** | ? 有限 | ? 完全可控 |
| **专业性** | 基础 | 专业 |
| **大小调整** | ? 固定 | ? 可调整 |
| **显示/隐藏** | 开关 | 编程控制 |
| **标签** | 固定 | Billboard |

---

## ?? 技术细节

### ArrowVisual3D

```csharp
特性:
- Point1: 箭头起点
- Point2: 箭头终点
- Diameter: 箭头粗细
- Fill: 箭头颜色

优点:
? 带箭头，方向明确
? 3D对象，随场景旋转
? 可调整大小和颜色
```

### BillboardTextVisual3D

```csharp
特性:
- Text: 显示的文字
- Position: 3D空间位置
- Foreground: 文字颜色
- FontSize: 字体大小

优点:
? 始终朝向相机
? 易于阅读
? 不随视图旋转
```

---

## ?? 注意事项

### 1. 坐标系原点

```
重要:
- 坐标系位于 (0, 0, 0)
- 如果导入的数据不在原点附近，坐标系可能看不到
- 建议导入数据后使用 FitCurvesToView() 调整视图
```

### 2. 坐标系大小

```
经验值:
- 小场景 (< 50 单位): 使用默认大小
- 中场景 (50-500): 放大 5-10 倍
- 大场景 (> 500): 放大 50-100 倍

或者使用自适应:
scale = Math.Max(curveSize * 0.1, 1.0);
```

### 3. 性能考虑

```
坐标系组件:
- 3 个 ArrowVisual3D (轴)
- 3 个 BillboardTextVisual3D (标签)
- 总共 6 个 3D 对象

影响:
? 性能影响极小
? 始终可见
? 不影响其他功能
```

---

## ? 验证测试

```
测试项目:
1. 启动应用
2. 观察3D视图
3. ? 看到红/绿/蓝坐标轴在场景中心

旋转测试:
1. 使用中键旋转视图
2. ? 坐标系随着旋转
3. ? 标签始终可读

缩放测试:
1. 滚轮放大/缩小
2. ? 坐标系保持可见
3. ? 比例正确

导入数据:
1. 导入 STEP 文件
2. ? 坐标系帮助理解数据方向
3. ? X/Y/Z 轴清晰可辨
```

---

## ?? 总结

### 改进效果

**修改前**:
```
? 坐标系在视图角落
? 不随场景旋转
? 难以理解当前方向
```

**修改后**:
```
? 坐标系在场景中心（原点）
? 随场景一起旋转
? 清楚显示X/Y/Z方向
? 符合专业3D软件习惯
? 可以调整大小
? 可以显示/隐藏
```

---

## ?? 相关文档

- `放样点数设置和坐标系显示修复说明.md` - 原坐标系说明
- `3D视图控制快速参考.md` - 视图操作指南
- `UG NX操作指南.md` - 完整操作手册

---

**现在坐标系位于3D场景的中心（原点）位置，会随着视图一起旋转！** ??

---

**最后更新**: 2024-12-22  
**版本**: v2.0.7  
**状态**: ? 已实现并验证
