# 取消控制点标签显示

## ?? 修改内容

完全禁用 USV 控制点的编号标签显示，只保留控制点本身（球体）。

---

## ? 修改位置

**文件**: `Views/PathEditor3D.xaml.cs`  
**方法**: `RenderUsvData()`  
**行数**: 约 202-204 行

### 修改前

```csharp
// add a small label above the sphere showing point index
var label = new BillboardTextVisual3D { 
  Text = (pi + 1).ToString(), 
    Position = LabelPosition(visualCenter), 
    Foreground = Brushes.Black, 
    Background = Brushes.White 
};
SceneRoot.Children.Add(label);
_indexToLabel[(ui, seg.Index, pi)] = label;
```

**效果**: 每个控制点上方都有编号标签（1, 2, 3...）

### 修改后

```csharp
// ? 禁用标签显示 - 注释掉以下代码
// var label = new BillboardTextVisual3D { Text = (pi + 1).ToString(), Position = LabelPosition(visualCenter), Foreground = Brushes.Black, Background = Brushes.White };
// SceneRoot.Children.Add(label);
// _indexToLabel[(ui, seg.Index, pi)] = label;
```

**效果**: 不再显示编号标签，只显示控制点球体

---

## ?? 效果对比

### 修改前 ?
```
3D 视图:
 1   2   3   4   5   ← 标签
 ・───・───・───・───・   ← 控制点
 
问题:
- 标签遮挡视图
- 密集点时标签重叠
- 视觉混乱
```

### 修改后 ?
```
3D 视图:
 ・───・───・───・───・   ← 只有控制点
 
优点:
- 视图清爽
- 无遮挡
- 便于观察路径形状
```

---

## ?? 为什么这样修改？

### 原因

1. **视觉清晰度**: 标签会遮挡 3D 视图，特别是在密集的控制点附近
2. **编辑体验**: 不需要标签也可以通过点击选择控制点
3. **专业外观**: CAD 软件通常不显示所有点的标签
4. **性能优化**: 减少文本渲染可以提高性能

### 设计决策

| 方案 | 优点 | 缺点 | 结论 |
|------|------|------|------|
| **完全禁用** ? | 视图清晰<br/>性能更好 | 无编号参考 | **采用** |
| 按需显示 ? | 可选择性显示 | 需要额外UI控制 | 不采用 |
| 鼠标悬停显示 ? | 按需显示 | 实现复杂 | 不采用 |

---

## ?? 相关代码

### 禁用标签的字典

原本用于存储标签的字典 `_indexToLabel` 现在不再使用，但保留定义以避免破坏现有代码：

```csharp
private readonly Dictionary<(int ui, int si, int pi), BillboardTextVisual3D> _indexToLabel = new();
```

**说明**: 虽然不再添加标签，但字典定义仍然保留，其他代码可能会引用它。

### 标签位置计算

原本用于计算标签位置的方法 `LabelPosition()` 仍然存在：

```csharp
private readonly Vector3D _labelOffsetVisual = new Vector3D(6.0 * _visualScale, 6.0 * _visualScale, 8.0 * _visualScale);

private Point3D LabelPosition(Point3D center)
{
    return new Point3D(center.X + _labelOffsetVisual.X, center.Y + _labelOffsetVisual.Y, center.Z + _labelOffsetVisual.Z);
}
```

**说明**: 这些代码保留，以便将来如果需要恢复标签功能时可以快速启用。

---

## ?? 视觉效果

### 场景 1: 直线路径
```
修改前:
1   2   3   4   5
・───・───・───・───・

修改后:
・───・───・───・───・
```

### 场景 2: 曲线路径
```
修改前:
    3─4
   u   v
  2     5
 u   v
1    6
(标签可能重叠)

修改后:
    ・─・
   u   v
  ・     ・
 u       v
・    ・
(清晰明了)
```

### 场景 3: 复杂路径
```
修改前: 标签密集，难以看清路径
修改后: 只看到点和线，路径清晰
```

---

## ? 验证清单

### 功能测试
- [x] 导入 XML/STEP 文件
- [x] 放样曲线
- [x] 生成步骤
- [x] 检查 3D 视图 - 无标签显示 ?
- [x] 控制点仍然可以点击选择 ?

### 视觉测试
- [x] 视图清晰，无标签遮挡 ?
- [x] 控制点颜色正确 ?
- [x] 路径线条清晰 ?

### 性能测试
- [x] 大量控制点（100+）性能正常 ?
- [x] 无文本渲染负担 ?

---

## ?? 修改文件

1. **Views/PathEditor3D.xaml.cs** - 注释掉标签创建代码

---

## ?? 如何恢复标签显示？

如果将来需要恢复标签显示，只需取消注释即可：

```csharp
// 取消以下注释即可恢复标签
var label = new BillboardTextVisual3D { 
    Text = (pi + 1).ToString(), 
    Position = LabelPosition(visualCenter), 
    Foreground = Brushes.Black, 
    Background = Brushes.White 
};
SceneRoot.Children.Add(label);
_indexToLabel[(ui, seg.Index, pi)] = label;
```

---

## ?? 未来改进建议

### 选项 1: 可选择性显示标签

添加一个复选框控制标签显示：

```csharp
// 添加属性
private bool _showLabels = false;
public bool ShowLabels 
{ 
    get => _showLabels; 
    set 
    { 
        _showLabels = value;
   RefreshLabels(); 
    } 
}

// 在渲染时检查
if (_showLabels)
{
    var label = new BillboardTextVisual3D { ... };
  SceneRoot.Children.Add(label);
}
```

### 选项 2: 鼠标悬停显示标签

只在鼠标悬停在点上时显示编号：

```csharp
private void OnPointHover(int ui, int si, int pi)
{
    // 显示临时标签
    var label = new BillboardTextVisual3D { 
      Text = $"Point {pi + 1}", 
        Position = ...,
    Foreground = Brushes.Yellow,
     Background = Brushes.Black
    };
    SceneRoot.Children.Add(label);
    _hoverLabel = label;
}

private void OnPointLeave()
{
    // 移除临时标签
    if (_hoverLabel != null)
    {
     SceneRoot.Children.Remove(_hoverLabel);
_hoverLabel = null;
    }
}
```

### 选项 3: 只显示选中点的标签

只为选中的控制点显示标签：

```csharp
private void OnPointSelected(int ui, int si, int pi)
{
    // 清除之前的标签
  if (_selectedLabel != null)
    {
     SceneRoot.Children.Remove(_selectedLabel);
    }
    
    // 为选中的点创建标签
    var label = new BillboardTextVisual3D { 
        Text = $"Selected: {pi + 1}", 
        Position = ...,
 Foreground = Brushes.White,
      Background = Brushes.Blue
    };
 SceneRoot.Children.Add(label);
    _selectedLabel = label;
}
```

---

## ?? 总结

### 修改内容
- ? 注释掉 USV 控制点标签创建代码
- ? 保留曲线点标签隐藏功能（`HideCurveLabels()`）

### 效果
- ? 3D 视图清爽整洁
- ? 无标签遮挡
- ? 性能提升

### 构建状态
? **编译成功**  
? **功能正常**  
? **视觉清晰**

---

**现在 3D 视图中不再显示控制点编号标签，视图更加清爽专业！** ??
